---
title: "MDS Knowledge Map"
format: 
  html:
    page-layout: full
---

# Hello this is test

```{r}
#| echo: false
#| message: false
#| warning: false

library(visNetwork)
library(dplyr)
library(readr)

# --- 1. THE READER ---
# Purpose: Load raw data from files
read_map_data <- function(nodes_path, edges_path) {
  nodes <- read_csv(nodes_path, show_col_types = FALSE)
  edges <- read_csv(edges_path, show_col_types = FALSE)
  return(list(nodes = nodes, edges = edges))
}

# --- 2. THE TRANSFORMER ---
# Purpose: Turn grid (1, 2, 3) into pixels and add styling
transform_map_data <- function(data) {
  # Process Nodes
  data$nodes <- data$nodes %>%
    mutate(
      # Scaling the grid coordinates
      x = column * 250, 
      y = row * 150,
      
      # Visual Styling
      label = label,
      shape = "box",
      color = I(list(list(
        background = "#D2E5FF", 
        border = "#2B7CE9",
        highlight = "#FFB347"
      ))),
      font = I(list(list(face = "Arial", size = 18))),
      shadow = TRUE,
      fixed = TRUE # prevents physics engine from moving your manual X/Y
    )
  
  # Process Edges
  data$edges <- data$edges %>%
    mutate(
      arrows = "to",
      color = "#848484",
      smooth = I(list(list(type = "curvedCCW", roundness = 0.2)))
    )
    
  return(data)
}

# --- 3. THE PLOTTER ---
# Purpose: Generate the interactive HTML visualization
plot_knowledge_map <- function(transformed_data) {
  visNetwork(transformed_data$nodes, transformed_data$edges) %>%
    visPhysics(enabled = FALSE) %>% # Disable physics since we have X/Y
    visOptions(
      highlightNearest = list(enabled = TRUE, degree = 1, hover = TRUE),
      nodesIdSelection = TRUE
    ) %>%
    visInteraction(dragNodes = FALSE, zoomView = TRUE)
}

# --- EXECUTION ---
raw_data <- read_map_data("data/nodes.csv", "data/edges.csv")
ready_data <- transform_map_data(raw_data)
plot_knowledge_map(ready_data)
```